---
title: "HMC3 qPCR"
author: "Oscar and Brian"
date: "5/17/2022"
output:
  html_document:
    toc: yes
    toc_float: yes
---

```{r include = F}
## Packages
if(!any(rownames(installed.packages()) == "pacman")){
   install.packages("pacman")
}

pacman::p_load(here,
               pheatmap,
               tidyverse,
               multcomp,
               multcompView, # Multiple comparison
               ggthemes,
               forcats) # Rename levels

data <- read.csv(here("tidy","qpcr_hmc3.csv"))

data_summary <- data %>%
        group_by(treatment) %>%
        summarize(IL1B = log2(mean(IL1B, na.rm = TRUE)),
                  IL6 = log2(mean(IL6, na.rm = TRUE)),
                  TNFA = log2(mean(TNFA, na.rm = TRUE)),
                  APOE = log2(mean(APOE, na.rm = TRUE)),
                  CD33 = log2(mean(CD33, na.rm = TRUE)),
                  ST6GALNAC3 = log2(mean(ST6GALNAC3, na.rm = TRUE)),
                  TREM2 = log2(mean(TREM2, na.rm = TRUE))) %>%
        filter(!(treatment == "control"))

```


## Heatmap
```{r echo = F, warning = F}
data_summary_df <- as.data.frame(data_summary) %>%
        subset(select = -c(CD33, ST6GALNAC3, TREM2))

## As Factor and reoder, and assign name rename
data_summary_df$treatment <- factor(data_summary_df$treatment, levels = c("abo", "cho", "fru","lps", "abo_cho","abo_fru", "abo_lps", "cho_lps", "fru_cho","fru_lps", "abo_cho_lps","abo_fru_cho_lps"))

## New Dataframe reordered
data_summary_df_reorder <- data_summary_df[order(data_summary_df$treatment), ]

## Assign Names to Levels
levels(data_summary_df_reorder$treatment) <- list(AβO = "abo",
                                                     Cholesterol = "cho",
                                                     Fructose = "fru",
                                                     LPS = "lps",
                                                     AβO_Cholesterol = "abo_cho",
                                                     AβO_Fructose = "abo_fru",
                                                     AβO_LPS = "abo_lps",
                                                     Cholesterol_LPS = "cho_lps",
                                                     Fructose_Cholesterol = "fru_cho",
                                                     Fructose_LPS = "fru_lps",
                                                     AβO_Cholesterol_LPS = "abo_cho_lps",
                                                     AβO_Fru_Chol_LPS = "abo_fru_cho_lps")


rownames(data_summary_df_reorder) <- data_summary_df_reorder$treatment




data_summary_df_reorder$treatment <- NULL

pheatmap(data_summary_df_reorder, main = expression("Gene Expression "*Log[2]*"FC"),  display_numbers = TRUE,
         border_color = "black",
         number_color = "black", filename = here("figures","qPCR","heatmap_new.jpg"))

pheatmap(data_summary_df_reorder, main = expression("Gene Expression "*Log[2]*"FC"),  display_numbers = TRUE,
         border_color = "black",
         number_color = "black")
```

![](../figures/qPCR/heatmap_new.jpg)


```{r include = F}
## Run first before qPCR Barplot
## Log2 Transform - Remove to not use
data <- data %>%
  mutate(IL1B = log2(IL1B),
         IL6 = log2(IL6),
         TNFA = log2(TNFA),
         APOE = log2(APOE),
         CD33 = log2(CD33),
         ST6GALNAC3 = log2(ST6GALNAC3),
         TREM2 = log2(TREM2))
```


```{r include = F}

## Rename Factors
data$treatment <- as.factor(data$treatment)

data$treatment <- factor(data$treatment, levels = c("control", "abo", "cho", "fru","lps", "abo_cho","abo_fru", "abo_lps", "cho_lps", "fru_cho","fru_lps", "abo_cho_lps","abo_fru_cho_lps"))

data$treatment <- do.call(
        fct_recode,
        c(list(data$treatment), setNames(c("control", "abo", "cho", "fru","lps", "abo_cho","abo_fru", "abo_lps", "cho_lps", "fru_cho","fru_lps", "abo_cho_lps","abo_fru_cho_lps"),
                                         c("Control","AβO", "Chol","Fruc", "LPS", "AβO/Chol", "AβO/Fruc", "AβO/LPS", "Chol/LPS", "Fruc/Chol", "Fruc/LPS", "AβO/Chol/LPS", "AβO/Fruc/Chol/LPS")))
)



```

***


## IL1B {.tabset .tabset-pills}

### IL1B Plot 
```{r echo = F}
anova <- aov(IL1B ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)

# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(IL1B), sd = sd(IL1B)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean+sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "IL1B", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","IL1B.jpg"), dpi = 300)
```

***

### IL1B Stats
```{r echo = F}
tukey
```

***

## IL6 Plot {.tabset .tabset-pills}

### IL6 Plot 

```{r echo = F}
anova <- aov(IL6 ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(IL6, na.rm = TRUE), sd = sd(IL6, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "IL6", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7") 

ggsave(here("figures","qPCR","IL6.jpg"), dpi = 300)
```

### IL6 Stats
```{r echo = F}
tukey
```

***

## TNFa {.tabset .tabset-pills}

### TNFa 
```{r echo = F}

### TNFA
anova <- aov(TNFA ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(TNFA, na.rm = TRUE), sd = sd(TNFA, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "TNFA", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","TNFa.jpg"), dpi = 300)
```

### TNFa Stats
```{r echo = F}
tukey
```


***

## APOE {.tabset .tabset-pills}

### APOE Plot
```{r echo = F}
### APOE
anova <- aov(APOE ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(APOE, na.rm = TRUE), sd = sd(APOE, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "APOE", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","APOE.jpg"), dpi = 300)
```

### APOE Stats
```{r echo = F}
tukey
```


***

## CD33 {.tabset .tabset-pills}

### CD33 Plot
```{r echo = F}
### CD33
anova <- aov(CD33 ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(CD33, na.rm = TRUE), sd = sd(CD33, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "CD33", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","CD33.jpg"), dpi = 300)
```

### CD33 Stats
```{r echo = F}
tukey
```


***

## ST6GALNAC3 {.tabset .tabset-pills}

### ST6GALNAC3 Plot 
```{r echo = F}
anova <- aov(ST6GALNAC3 ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(ST6GALNAC3, na.rm = TRUE), sd = sd(ST6GALNAC3, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "ST6GALNAC3", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","ST6GALNAC3.jpg"), dpi = 300)
```

### ST6GALNAC3 Stats
```{r echo = F}
tukey
```


***

## TREM2 {.tabset .tabset-pills}


### TREM2 Plot
```{r echo = F}
anova <- aov(TREM2 ~ treatment, data = data)
p_value <- signif(summary(anova)[[1]][["Pr(>F)"]][1],3)
# Tukey's test
tukey <- TukeyHSD(anova)

# compact letter display
cld <- multcompLetters4(anova, tukey)

dt <- group_by(data, treatment) %>%
        summarise(mean=mean(TREM2, na.rm = TRUE), sd = sd(TREM2, na.rm = TRUE)) %>%
        arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$treatment)
dt$cld <- cld$Letters

ggplot(dt, aes(treatment, mean)) + 
        geom_bar(stat = "identity", aes(fill = mean), show.legend = FALSE) +
        geom_errorbar(aes(ymin = mean-sd, ymax=mean + sd), width = 0.2) +
        labs(x = "Treatment", y = expression(Log[2]*"FC"), title = "TREM2", subtitle = paste("ANOVA: P","=", paste0(p_value, collapse = NULL))) +
        geom_text(aes(label = cld, y = mean + sd), vjust = -0.5) +
        theme_classic() +
        theme(axis.text.x = element_text(angle = 90, color = "black")) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")

ggsave(here("figures","qPCR","TREM2.jpg"), dpi = 300)
```

### TREM2 Stats
```{r echo = F}
tukey
```

